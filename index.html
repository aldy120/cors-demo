<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Demo</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
</head>

<body>
    <h1>CORS Demo</h1>
    <p>This is a page to test cross-origin resource sharing with different settings in S3 and CloudFront. You should have basic knowledge about <a
            href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener">Cross-Origin
            resources sharing (CORS)</a> and <a
            href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank"
            rel="noopener">Same-Origin policy</a> before using this website.</p>
            <p>Press keyboard
                <button id="esc">esc</button> to remove all images. </p>

    <h2>1. S3 without CORS settings</h2>
    <p>Use default S3 configuration. No <a
            href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/enabling-cors-examples.html" target="_blank"
            rel="noopener">CORS policy</a> in
        S3. In this case, S3 will not return <code>access-control-allow-origin</code> response header.</p>
    <div id="container"></div>
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>2. S3 with CORS settings</h2>
    <p>
        Use the S3 CORS policy from <a href="https://stackoverflow.com/a/64586341/14393225" target="_blank"
            rel="noopener">stackoverflow</a>.
    </p>
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>3. CloudFront default settings</h2>
    <p>
        Use CloudFront default settings. The S3 origin is with CORS settings. CloudFront use cache policy
        CachingOptimized by default.
    </p>
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>4. CloudFront with simple-cors response header policy</h2>
    <p>Use CloudFront + S3 with managed response header policy <a
            href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-managed-response-headers-policies.html#managed-response-headers-policies-cors"
            target="_blank" rel="noopener">simple-CORS</a>. The S3 origin is without CORS settings. CloudFront won't
        return <code>access-control-allow-origin</code> for a <a
            href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests" target="_blank"
            rel="noopener">simple request</a>.
    </p>
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>


    <h2>5. CloudFront with cors-preflight response header policy</h2>
    <p>Use CloudFront + S3 with managed response header policy <a
            href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-managed-response-headers-policies.html#managed-response-headers-policies-cors"
            target="_blank" rel="noopener">CORS-With-Preflight</a>. The S3 origin is without CORS settings.</p>
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>6. CloudFront custom header to origin</h2>
    The S3 origin is with CORS settings. Add a request header <code>origin</code> in CloudFront to S3, so S3 responds
    <code>access-control-allow-origin</code> every time.
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>7. CORS with caching optimized cache policy</h2>
    Use CloudFront managed cache policy <a
        href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-managed-origin-request-policies.html#managed-origin-request-policies-list"
        target="_blank" rel="noopener"><code>CachingOptimized</code></a> and managed origin request policy <a
        href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-managed-cache-policies.html#managed-cache-policies-list"
        target="_blank" rel="noopener"><code>CORS-S3Origin</code></a>. The S3 origin is with CORS settings.
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <h2>8. CORS with settings in knowledge center</h2>
    Use the same policy as mentioned in <a
        href="https://aws.amazon.com/premiumsupport/knowledge-center/no-access-control-allow-origin-error/"
        target="_blank" rel="noopener">knowledge center</a>.
    <div class="box">
        <label>GET by <code>img</code> tag</label>
        <button class="img-tag-btn">test</button>
    </div>
    <div class="box">
        <label>GET by <code>img crossorigin</code> tag</label>
        <button class="img-tag-crossorigin-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API</label>
        <button class="fetch-btn">test</button>
    </div>
    <div class="box">
        <label>GET by fetch API with preflight</label>
        <button class="fetch-preflight-btn">test</button>
    </div>

    <p>
        Image source: https://unsplash.com/photos/jLi7xbYnYro
    </p>
    <h1>FAQ</h1>
    <div class="box">
        <h3>What is the best way to prevent potential CORS error in any edge cases?</h3>
        <p>Use #6.</p>
    </div>
    <div class="box">
        <h3>Why a pure img tag can always access to image and isn't blocked by CORS?</h3>
        <p>Please find "Cross-origin embedding is typically allowed" and read the details in <a
                href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#cross-origin_network_access"
                target="_blank" rel="noopener">this article</a>.</p>
    </div>
    <div class="box">
        <h3>How do I tell whether the browser send a CORS request or not?</h3>
        <p>Check if the request have <code>Origin:xxx</code> request header.</p>
    </div>
    <div class="box">
        <h3>How do I know whether server side approved the CORS request from the source origin?</h3>
        <p>Check response header <code>access-control-allow-origin: *</code>.</p>
    </div>
    <script src="index.js"></script>
</body>

</html>